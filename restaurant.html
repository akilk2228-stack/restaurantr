<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Restaurant QR Order System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase SDK (compat for WebView) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body{font-family:Arial;background:#f4f4f4;margin:0}
header{background:#b71c1c;color:#fff;padding:12px;text-align:center}
.card{background:#fff;margin:10px;padding:10px;border-radius:6px}
button{padding:8px 12px;margin:5px;border:none;border-radius:5px;cursor:pointer}
.add{background:green;color:#fff}
.place{background:#b71c1c;color:#fff;width:100%}
.ready{background:orange}
.hidden{display:none}
input,select{width:100%;padding:7px;margin:5px 0}
</style>
</head>

<body>

<header>ğŸ½ï¸ Restaurant QR Order</header>

<!-- CUSTOMER -->
<div id="customer" class="card">
<b>Table:</b> <span id="tableNo"></span><br><br>
<input id="custName" placeholder="à¤†à¤ªà¤•à¤¾ à¤¨à¤¾à¤®">
<h3>Menu</h3>
<div id="menu"></div>
<hr>
<b>Total: â‚¹<span id="total">0</span></b>
<button class="place" onclick="placeOrder()">Order Place</button>
<div id="custStatus"></div>
<button onclick="printBill()">ğŸ§¾ Bill Print</button>
</div>

<!-- KITCHEN -->
<div id="kitchen" class="hidden">
<header>ğŸ‘¨â€ğŸ³ Kitchen Panel</header>
<div id="kitchenOrders"></div>
</div>

<!-- ADMIN -->
<div id="admin" class="hidden">
<header>ğŸ§‘â€ğŸ’¼ Admin Panel</header>
<input id="itemName" placeholder="Item Name">
<input id="itemPrice" placeholder="Price">
<select id="itemAvail">
<option value="true">Available</option>
<option value="false">Unavailable</option>
</select>
<button onclick="addMenu()">Add / Update Item</button>
<div id="adminMenu"></div>
</div>

<script>
// ğŸ”¥ Firebase Config (à¤†à¤ªà¤•à¥€ keys)
firebase.initializeApp({
 apiKey: "AIzaSyCgaZ9DqGuszvycCRuJceNvg7G86OTc9oU",
 authDomain: "restaurant-55333.firebaseapp.com",
 projectId: "restaurant-55333",
 storageBucket: "restaurant-55333.firebasestorage.app",
 messagingSenderId: "279347685173",
 appId: "1:279347685173:web:cb1a120e25e3adb856ce7c"
});

const db = firebase.firestore();

// ğŸ” Table Detect (QR)
const params = new URLSearchParams(location.search);
const table = params.get("table") || "N/A";
document.getElementById("tableNo").innerText = table;

// ğŸ” Role Detect
if(location.hash=="#kitchen"){
 customer.classList.add("hidden");
 kitchen.classList.remove("hidden");
 loadKitchen();
}
if(location.hash=="#admin"){
 customer.classList.add("hidden");
 admin.classList.remove("hidden");
 loadAdmin();
}

// ğŸ›’ Customer Menu
let cart=[], total=0;
db.collection("menu").onSnapshot(snap=>{
 menu.innerHTML="";
 snap.forEach(doc=>{
  let d=doc.data();
  if(d.available){
   let btn=document.createElement("button");
   btn.className="add";
   btn.innerText=`${d.name} â‚¹${d.price}`;
   btn.onclick=()=>{
    cart.push(d);
    total+=d.price;
    totalSpan.innerText=total;
   }
   menu.appendChild(btn);
  }
 });
});

// ğŸ“¦ Place Order
function placeOrder(){
 let name=custName.value;
 if(!name||cart.length==0){
  alert("à¤¨à¤¾à¤® à¤¡à¤¾à¤²à¥‡à¤‚ à¤”à¤° item à¤šà¥à¤¨à¥‡à¤‚");
  return;
 }
 db.collection("orders").add({
  customerName:name,
  table,
  items:cart,
  total,
  status:"Pending",
  readyTime:"",
  time:Date.now()
 });
 custStatus.innerText="â³ Order Pending";
}

// ğŸ”„ Real-time Status
db.collection("orders").onSnapshot(snap=>{
 snap.forEach(doc=>{
  let o=doc.data();
  if(o.table==table){
   custStatus.innerText=`Status: ${o.status} ${o.readyTime}`;
  }
 });
});

// ğŸ‘¨â€ğŸ³ Kitchen Panel
function loadKitchen(){
 db.collection("orders").onSnapshot(snap=>{
  kitchenOrders.innerHTML="";
  snap.forEach(doc=>{
   let o=doc.data();
   if(o.status!="Completed"){
    kitchenOrders.innerHTML+=`
    <div class="card">
    Table ${o.table} - ${o.customerName}<br>
    <button class="ready" onclick="markReady('${doc.id}')">
    Ready in 10 min
    </button>
    </div>`;
   }
  });
 });
}

function markReady(id){
 db.collection("orders").doc(id).update({
  status:"Ready",
  readyTime:"(10 min)"
 });
}

// ğŸ§‘â€ğŸ’¼ Admin Panel
function addMenu(){
 db.collection("menu").add({
  name:itemName.value,
  price:Number(itemPrice.value),
  available:itemAvail.value=="true"
 });
}

function loadAdmin(){
 db.collection("menu").onSnapshot(snap=>{
  adminMenu.innerHTML="";
  snap.forEach(doc=>{
   let d=doc.data();
   adminMenu.innerHTML+=`
   <div class="card">
   ${d.name} â‚¹${d.price} (${d.available})
   </div>`;
  });
 });
}

// ğŸ§¾ Bill Print
function printBill(){
 let win=window.open();
 win.document.write("<h2>Restaurant Bill</h2>");
 win.document.write("Table: "+table+"<br>");
 cart.forEach(i=>{
  win.document.write(i.name+" â‚¹"+i.price+"<br>");
 });
 win.document.write("<b>Total â‚¹"+total+"</b>");
 win.print();
}
</script>

</body>
</html>
